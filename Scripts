CREATE DATABASE TechStore;
GO

USE TechStore;
GO

CREATE TABLE Categoria (
    ID_Categoria INT IDENTITY(1,1) PRIMARY KEY,
    Nome_Categoria VARCHAR(50) NOT NULL
);

CREATE TABLE Produto (
    ID_Produto INT IDENTITY(1,1) PRIMARY KEY,
    Nome_Produto VARCHAR(100) NOT NULL,
    Preco DECIMAL(10,2) NOT NULL,
    Estoque INT NOT NULL,
    ID_Categoria INT,
    FOREIGN KEY (ID_Categoria) REFERENCES Categoria(ID_Categoria)
);

CREATE TABLE Cliente (
    ID_Cliente INT IDENTITY(1,1) PRIMARY KEY,
    Nome VARCHAR(100) NOT NULL,
    Email VARCHAR(100) NOT NULL UNIQUE,
    Telefone VARCHAR(20)
);

CREATE TABLE Pedido (
    ID_Pedido INT IDENTITY(1,1) PRIMARY KEY,
    ID_Cliente INT NOT NULL,
    Data_Pedido DATE NOT NULL,
    Valor_Total DECIMAL(10,2),
    FOREIGN KEY (ID_Cliente) REFERENCES Cliente(ID_Cliente)
);

CREATE TABLE Pagamento (
    ID_Pagamento INT IDENTITY(1,1) PRIMARY KEY,
    ID_Pedido INT NOT NULL,
    Tipo VARCHAR(30),
    Status VARCHAR(30),
    FOREIGN KEY (ID_Pedido) REFERENCES Pedido(ID_Pedido)
);

CREATE TABLE Item_Pedido (
    ID_Pedido INT NOT NULL,
    ID_Produto INT NOT NULL,
    Quantidade INT NOT NULL,
    Subtotal DECIMAL(10,2),
    PRIMARY KEY (ID_Pedido, ID_Produto),
    FOREIGN KEY (ID_Pedido) REFERENCES Pedido(ID_Pedido),
    FOREIGN KEY (ID_Produto) REFERENCES Produto(ID_Produto)
);




USE TechStore;
GO
INSERT INTO Categoria (Nome_Categoria) VALUES
('Eletrônicos'),
('Periféricos'),
('Celulares');

INSERT INTO Produto (Nome_Produto, Preco, Estoque, ID_Categoria) VALUES
('Mouse Gamer RGB', 79.90, 120, 2),
('Teclado Mecânico', 199.90, 80, 2),
('Smartphone X200', 1499.90, 50, 3),
('Fone Bluetooth Pro', 249.90, 110, 1);

INSERT INTO Cliente (Nome, Email, Telefone) VALUES
('Ana Silva', 'ana@gmail.com', '11988887777'),
('Carlos Souza', 'carlos@hotmail.com', '11999996666'),
('Pedro Henrique', 'pedro@gmail.com', '11977775555');

INSERT INTO Pedido (ID_Cliente, Data_Pedido, Valor_Total) VALUES
(1, '2024-10-15', 279.80),
(2, '2024-10-18', 1499.90);

INSERT INTO Pagamento (ID_Pedido, Tipo, Status) VALUES
(1, 'Cartão de Crédito', 'Aprovado'),
(2, 'PIX', 'Aprovado');

INSERT INTO Item_Pedido (ID_Pedido, ID_Produto, Quantidade, Subtotal) VALUES
(1, 1, 2, 159.80),
(1, 2, 1, 120.00),
(2, 3, 1, 1499.90);




USE TechStore;
GO

SELECT * FROM Categoria;
SELECT * FROM Produto;
SELECT * FROM Cliente;
SELECT * FROM Pedido;
SELECT * FROM Pagamento;
SELECT * FROM Item_Pedido;




-- 1. Produtos + categoria
SELECT P.Nome_Produto, P.Preco, C.Nome_Categoria
FROM Produto P
JOIN Categoria C ON P.ID_Categoria = C.ID_Categoria;

-- 2. Pedidos + nome do cliente
SELECT Pe.ID_Pedido, C.Nome, Pe.Data_Pedido, Pe.Valor_Total
FROM Pedido Pe
JOIN Cliente C ON Pe.ID_Cliente = C.ID_Cliente;

-- 3. Itens detalhados do pedido
SELECT Cli.Nome, Pro.Nome_Produto, IP.Quantidade, IP.Subtotal
FROM Item_Pedido IP
JOIN Pedido Ped ON IP.ID_Pedido = Ped.ID_Pedido
JOIN Produto Pro ON IP.ID_Produto = Pro.ID_Produto
JOIN Cliente Cli ON Ped.ID_Cliente = Cli.ID_Cliente;

-- 4. Produtos acima de R$200
SELECT Nome_Produto, Preco
FROM Produto
WHERE Preco > 200;

-- 5. Top 3 produtos mais caros
SELECT TOP 3 Nome_Produto, Preco
FROM Produto
ORDER BY Preco DESC;




-- 1. Atualizar o preço de um produto
UPDATE Produto
SET Preco = 89.90
WHERE ID_Produto = 1;

-- 2. Reduzir estoque de um produto (simulando venda)
UPDATE Produto
SET Estoque = Estoque - 1
WHERE ID_Produto = 3;

-- 3. Alterar status de um pagamento
UPDATE Pagamento
SET Status = 'Estornado'
WHERE ID_Pagamento = 1;




-- 1. Remover um item específico do pedido 1
DELETE FROM Item_Pedido
WHERE ID_Pedido = 1 AND ID_Produto = 2;

-- 2. Remover um cliente sem pedidos
DELETE FROM Cliente
WHERE ID_Cliente = 3;

-- 3. Remover categoria que não possui produtos relacionados
DELETE FROM Produto
WHERE ID_Produto = 4;


